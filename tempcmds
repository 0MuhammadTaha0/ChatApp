CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 
    username TEXT NOT NULL, hash TEXT NOT NULL, 
    online INTEGER default 0 CHECK (online BETWEEN 0 AND 1));

CREATE TABLE friendships (
    userid INTEGER,
    friendid INTEGER,
    PRIMARY KEY (userid, friendid),
    FOREIGN KEY (userid) REFERENCES users(id),
    FOREIGN KEY (friendid) REFERENCES users(id)
);

CREATE TABLE friend_requests(
    userid INTEGER,
    friendid INTEGER,
    PRIMARY KEY (userid, friendid),
    FOREIGN KEY (userid) REFERENCES users(id),
    FOREIGN KEY (friendid) REFERENCES users(id)
);

CREATE TABLE messages(
    sender INTEGER NOT NULL,
    receiver INTEGER NOT NULL,
    message TEXT NOT NULL,
    timestamp TEXT NOT NULL,
    FOREIGN KEY (sender) REFERENCES users(id),
    FOREIGN KEY (receiver) REFERENCES users(id)
);

SELECT users.username as sender, b.username as receiver, message, timestamp FROM messages
JOIN users ON users.id = messages.sender
JOIN users b ON b.id = messages.receiver
WHERE
(messages.sender = 1 and messages.receiver = 2)
OR
(messages.sender = 2 and messages.receiver = 1);

            

INSERT INTO messages values (2, 1, '1st msg reply', datetime('now'));